
{% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
<h1>Q&A 채팅</h1>
<select id="model-select">
    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
    <option value="gpt-4">GPT-4</option>
</select>
<div id="chat-container">
    <div id="chat-messages"></div>
    <input type="text" id="user-input" placeholder="질문을 입력하세요">
    <button onclick="sendMessage()">전송</button>
</div>

<script>
function sendMessage() {
    var userInput = document.getElementById('user-input').value;
    var model = document.getElementById('model-select').value;
    
    // 사용자 메시지 표시
    addMessage('user', userInput);

    fetch('/chat/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({query: userInput, model: model})
    })
    .then(response => response.json())
    .then(data => {
        addMessage('assistant', data.answer);
        if (data.sources) {
            addSources(data.sources);
        }
    });

    document.getElementById('user-input').value = '';
}

function addMessage(role, content) {
    var messageDiv = document.createElement('div');
    messageDiv.className = role;
    messageDiv.textContent = content;
    document.getElementById('chat-messages').appendChild(messageDiv);
}

function addSources(sources) {
    var sourcesDiv = document.createElement('div');
    sourcesDiv.className = 'sources';
    sourcesDiv.innerHTML = '<h4>참고한 페이지:</h4>';
    sources.forEach((source, index) => {
        sourcesDiv.innerHTML += `<p><strong>출처 ${index + 1}:</strong> ${source.source}<br>${source.text}...</p>`;
    });
    document.getElementById('chat-messages').appendChild(sourcesDiv);
}
</script>